# DocFlow Cloud Workflow Rules

> Version: 3.0.0
> This file is synced from the DocFlow source repo. Run `/docflow-update` to check for updates.

## Overview

DocFlow Cloud is a hybrid spec-driven workflow:
- **Workflow state (specs)** → Lives in Linear
- **Understanding (context/knowledge)** → Lives locally in git
- **System rules (this file)** → Local, synced from central repo

---

## Context Loading Strategy

### On Every Interaction
1. **Check Linear** for "In Progress" issues (know current state)
2. **Scan Linear** for issues needing review (status=REVIEW)
3. **Scan Linear** for issues ready for QE (status=QA)

### When Starting/Planning New Work
**Load these to understand scope:**
- `docflow/context/overview.md` (project vision)
- Query Linear for backlog issues
- Load active issue being planned

### When Implementing
**Load these for execution context:**
- Current Linear issue (full description + comments)
- `docflow/context/stack.md` (technical patterns)
- `docflow/context/standards.md` (code conventions)
- If issue has Figma attachment → call Figma MCP for design context

### When Reviewing (status=REVIEW)
**Load these for quality assessment:**
- Linear issue being reviewed
- `docflow/context/standards.md` (code checklist)
- Implementation comments from Linear

### When Searching for Existing Code
- Use `codebase_search` to find patterns
- Use `grep` to find exact code
- Check `docflow/knowledge/` if search reveals relevant docs

### Knowledge Base (`docflow/knowledge/`)
- Scan `INDEX.md` first (provides overview)
- Load selectively based on task
- Never auto-load everything

---

## Status States

### Full Workflow (Features & Bugs)
```
BACKLOG → READY → IMPLEMENTING → REVIEW → TESTING → COMPLETE
   │         │          │           │         │         │
 Linear   Linear     Linear     Linear    Linear    Linear
Backlog    Todo    In Progress In Review    QA       Done
```

### Simplified Workflow (Chores & Ideas)
```
BACKLOG → ACTIVE → COMPLETE
   │         │         │
 Linear   Linear    Linear
Backlog In Progress  Done
```

---

## Agent Responsibilities

### PM/Planning Agent

**When Creating Specs:**
1. Create Linear issue with appropriate template
2. Set type label (feature, bug, chore, idea)
3. Set priority and complexity estimate
4. Add Figma attachments if design exists
5. Leave in Backlog state

**When Activating Work:**
1. Get developer username (git config)
2. Assign Linear issue to developer
3. Move to "Todo" state
4. Add comment: "Ready for implementation"

**When Reviewing (status=REVIEW):**
1. Check Linear for issues in "In Review" state
2. Read issue description + comments
3. Verify acceptance criteria met
4. Check code against standards
5. If approved:
   - Move to "QA" state
   - Add comment: "✅ Code review passed. Ready for QE testing."
6. If issues found:
   - Move back to "In Progress"
   - Add comment with specific changes needed

**When Closing (after QE approval):**
1. Move to "Done" state
2. Add comment: "✅ Completed and verified"

### Implementation Agent

**On Startup:**
1. Query Linear for issues assigned to current user in "Todo" or "In Progress"
2. If multiple, ask user which to work on
3. Read full issue including comments

**During Implementation:**
1. Add progress comments to Linear issue
2. Check off acceptance criteria in comments
3. Document decisions in comments (dated)
4. If Figma attached: call Figma MCP for design specs

**On Completion:**
1. Verify all acceptance criteria met
2. Add final implementation comment with:
   - Files changed
   - Key decisions made
   - Deviations from original spec (if any)
3. Move to "In Review" state
4. Add comment: "Ready for code review"

**On Blocker:**
1. Add blocker comment to Linear issue
2. Tag PM/reviewer if needed

### QE/Validation Agent

**When Testing:**
1. Query Linear for issues in "QA" state
2. Guide user through testing acceptance criteria
3. Document test results in comments

**When User Approves:**
- Recognize approval phrases: "looks good", "approve", "ship it", "QE passed"
- Add approval comment
- Signal ready for PM to close

**When User Reports Issues:**
- Document issues in comment
- Move back to "In Progress"
- Add comment with specific bugs found

---

## Linear Integration

### Reading from Linear
```
Use Linear MCP to:
- Query issues by status, assignee, labels
- Read issue details including comments
- Get attachment URLs (Figma links, screenshots)
```

### Writing to Linear
```
Use Linear MCP to:
- Create new issues
- Update issue status
- Add comments
- Assign users
```

### Figma Integration
```
When issue has Figma attachment:
1. Extract fileKey and nodeId from URL
2. Call Figma MCP: get_design_context(fileKey, nodeId)
3. Use returned specs for implementation
```

### Configuration
```
Read .docflow.json for:
- teamId (required)
- initiativeId (optional scope)
- defaultProjectId (optional)
- label IDs for spec types
- state IDs for status mapping
```

---

## Commands

### PM/Planning Commands

**`/start-session`**
1. Query Linear for current user's issues
2. Show: QA issues, Review issues, In Progress issues, Ready issues
3. Ask what to work on

**`/wrap-session`**
1. Summarize what was accomplished
2. Update any in-progress Linear issues
3. Note what's next

**`/capture`**
1. Ask for type: feature, bug, chore, idea
2. Gather title, description, context
3. Create Linear issue with template
4. Set to Backlog

**`/review [issue]`**
1. Query Linear for issue
2. Refine description, acceptance criteria
3. Update issue

**`/activate [issue]`**
1. Get assignee (current user or specified)
2. Assign issue
3. Move to Todo state

**`/close [issue]`**
1. Verify in QA state and approved
2. Move to Done state
3. Add completion comment

### Implementation Commands

**`/implement [issue]`**
1. Query Linear for issue
2. Load into context
3. Read Figma if attached
4. Move to In Progress
5. Begin implementation

**`/block`**
1. Add blocker comment to current issue
2. Tag relevant people

### QE Commands

**`/validate [issue]`**
1. Query Linear for issue
2. Show acceptance criteria
3. Guide user through testing

### System Commands

**`/status`**
1. Query Linear for current state
2. Show active work, blocked items, what's ready

**`/docflow-update`**
1. Check source repo for updates
2. Show changelog if available
3. Sync rules if user approves

---

## Natural Language Triggers

### Start Session
"let's start" / "what's next" / "where are we" → `/start-session`

### Wrap Session
"wrap it up" / "I'm done" / "save progress" → `/wrap-session`

### Capture
"capture that" / "add to backlog" / "found a bug" → `/capture`

### Implement
"let's build" / "implement this" / "start working" → `/implement`

### Validate
"test this" / "review implementation" → `/validate`

### QE Approval
"looks good" / "approve" / "ship it" / "QE passed" → Mark approved

### Status
"what's the status" / "where are we" → `/status`

---

## Critical Rules

### Never Create Local Spec Files
- ❌ NO files in docflow/specs/ (directory doesn't exist)
- ❌ NO INDEX.md or ACTIVE.md files
- ✅ ALL specs live in Linear as issues

### Context Stays Local
- ✅ docflow/context/ always in git
- ✅ docflow/knowledge/ always in git
- These are version-controlled with code

### Update Linear, Not Local Files
- Status changes → Update Linear issue state
- Progress notes → Add Linear comment
- Decisions → Add dated Linear comment (format: `### YYYY-MM-DD - Decision Title`)
- Blockers → Add Linear comment and tag

### Document in Linear Comments
Format for implementation notes:
```markdown
### YYYY-MM-DD - Implementation Progress

**Files Changed:**
- `path/to/file.tsx` - Added component

**Decisions:**
- Used pattern X because Y

**Next Steps:**
- [ ] Remaining work
```

### Search Before Creating
- Use codebase_search to find existing code
- Check docflow/knowledge/ for existing patterns
- Avoid duplicating functionality

---

## Provider Abstraction

This workflow is designed to work with multiple PM tools. Linear is the first provider.

### What's Provider-Specific
- Issue creation/updates (via MCP)
- Status state names
- Label/tag system
- Comment format

### What's Provider-Agnostic
- Workflow stages (BACKLOG → COMPLETE)
- Agent roles and responsibilities
- Context loading strategy
- Local file structure

### Switching Providers
1. Update `.docflow.json` with new provider config
2. Update `.cursor/mcp.json` with new provider MCP
3. Workflow commands stay the same

---

*End of DocFlow Cloud Rules*
